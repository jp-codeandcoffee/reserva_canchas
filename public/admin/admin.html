<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Administrador</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .tab-content { padding-top: 1rem; }
    .nav-link { cursor: pointer; }
  </style>
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
  <span class="navbar-brand mb-0 h1">Panel Administrador</span>
  <button class="btn btn-outline-light" onclick="logoutAdmin()">Salir</button>
</nav>

<div class="container-fluid mt-3">
  <!-- Pestañas -->
  <ul class="nav nav-tabs" id="adminTabs">
    <li class="nav-item">
      <a class="nav-link active" data-bs-toggle="tab" href="#tabCanchas">Canchas</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-bs-toggle="tab" href="#tabReservas">Reservas</a>
    </li>
  </ul>

  <!-- Contenido de pestañas -->
  <div class="tab-content">
    <!-- CANCHAS -->
    <div class="tab-pane fade show active" id="tabCanchas">
      <form id="fieldForm" class="row g-3 mt-3">
        <input type="hidden" id="fieldId">
        <div class="col-md-3"><input type="text" class="form-control" id="fieldName" placeholder="Nombre" required></div>
        <div class="col-md-3"><input type="text" class="form-control" id="fieldLocation" placeholder="Ubicación" required></div>
        <div class="col-md-2"><input type="number" class="form-control" id="fieldPrice" placeholder="Precio" required></div>
        <div class="col-md-2"><button class="btn btn-primary w-100" id="btnGuardar">Guardar</button></div>
      </form>
      <table class="table table-striped mt-3">
        <thead><tr><th>ID</th><th>Nombre</th><th>Ubicación</th><th>Precio</th><th>Acciones</th></tr></thead>
        <tbody id="fieldsTable"></tbody>
      </table>
    </div>

    <!-- RESERVAS -->
    <div class="tab-pane fade" id="tabReservas">
      <table class="table table-striped mt-3">
        <thead><tr><th>Usuario</th><th>Cancha</th><th>Fecha</th><th>Hora</th><th>Estado</th></tr></thead>
        <tbody id="reservasTable"></tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const apiFields = '/api/admin/fields';
const apiReservas = '/api/admin/reservations';
const headers = { Authorization: 'Bearer admin123', 'Content-Type': 'application/json' };

// Cargar canchas
function loadFields() {
  fetch(apiFields, { headers })
    .then(r => r.json())
    .then(data => {
      const tbody = document.querySelector('#fieldsTable');
      tbody.innerHTML = '';
      data.forEach(f => {
        tbody.innerHTML += `
          <tr>
            <td>${f.id}</td>
            <td>${f.name}</td>
            <td>${f.location}</td>
            <td>${f.price_per_hour}</td>
            <td>
              
              <button class="btn btn-sm btn-danger" onclick="deleteField(${f.id})">Eliminar</button>
            </td>
          </tr>`;
      });
    });
}

// Cargar reservas
function loadReservas() {
  fetch(apiReservas, { headers })
    .then(r => r.json())
    .then(data => {
      const tbody = document.querySelector('#reservasTable');
      tbody.innerHTML = '';
      data.forEach(r => {
        tbody.innerHTML += `
          <tr>
            <td>${r.full_name}</td>
            <td>${r.field_name}</td>
            <td>${r.date}</td>
            <td>${r.start_time}</td>
            <td>${r.status}</td>
          </tr>`;
      });
    });
}

// CRUD Canchas
function editField(id) {
  fetch(`${apiFields}/${id}`, { headers })
    .then(r => r.json())
    .then(f => {
      document.getElementById('fieldId').value = f.id;
      document.getElementById('fieldName').value = f.name;
      document.getElementById('fieldLocation').value = f.location;
      document.getElementById('fieldPrice').value = f.price_per_hour;
      document.getElementById('btnGuardar').textContent = 'Actualizar';
    });
}

function deleteField(id) {
  if (!confirm('¿Eliminar esta cancha?')) return;
  fetch(`${apiFields}/${id}`, { method: 'DELETE', headers })
    .then(() => loadFields());
}

document.getElementById('fieldForm').addEventListener('submit', e => {
  e.preventDefault();
  const id = document.getElementById('fieldId').value;
  const body = {
    name: document.getElementById('fieldName').value,
    location: document.getElementById('fieldLocation').value,
    price_per_hour: Number(document.getElementById('fieldPrice').value)
  };
  const method = id ? 'PUT' : 'POST';
  const url = id ? `${apiFields}/${id}` : apiFields;

  fetch(url, { method, headers, body: JSON.stringify(body) })
    .then(() => {
      document.getElementById('fieldForm').reset();
      document.getElementById('btnGuardar').textContent = 'Guardar';
      loadFields();
    });
});

function logoutAdmin() {
  sessionStorage.removeItem('admin');
  location.href = '/admin/login.html';
}

document.addEventListener('DOMContentLoaded', () => {
  loadFields();
  loadReservas();
});
</script>
</body>
</html>
